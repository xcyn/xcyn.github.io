<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>小熊抽奖页面</title>
    <style>
        /*自己写的延迟加载特效开始*/
        .myLoading {
            width: 100%;
            height: 100%;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 10;
            background-color: #c02524;
        }

        .myLoading-change {
            width: 1rem;
            height: 1rem;
            position: absolute;
            top: 50%;
            left: 50%;
            margin-top: -0.5rem;
            margin-left: -0.5rem;
            border-radius: 100%;
            background-color: #fff;
            text-align: center;
            font-size: 0.16rem;
            line-height: 1rem;
            color: #666;
            -webkit-animation: loading 1.2s infinite ease-in-out;
            animation: loading 1.2s infinite ease-in-out;
            -webkit-animation-fill-mode: both;
            animation-fill-mode: both;
        }

        @keyframes loading {
            0%, 80%, 100% {
                -webkit-transform: scale(0);
                border-radius: 100%;
            }
            40% {
                -webkit-transform: scale(2);
                border-radius: 100%;
            }
        }

        @-webkit-keyframes loading {
            0%, 80%, 100% {
                -webkit-transform: scale(0);
                border-radius: 100%;
            }
            40% {
                -webkit-transform: scale(2);
                border-radius: 100%;
            }
        }

        /*自己写的延迟加载特效结束*/
    </style>
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0"/>
    <!--<meta name="x5-fullscreen" content="true">-->
    <!--<meta name="full-screen" content="yes">-->
    <!-- 移动端rem适配-->
    <script>
        (function (b, c) {
            var d = b.documentElement,
                    resizeEvt = 'orientationchange' in c ? 'orientationchange' : 'resize',
                    recalc = function () {
                        var a = d.clientWidth;
                        if (!a) return;
                        d.style.fontSize = (20 * (a / 640)) > 100 ? 100 + "px" : (100 * (a / 640)) + 'px'
                    },
                    anime = c.requestAnimationFrame || c.webkitRequestAnimationFrame || c.mozRequestAnimationFrame || c.oRequestAnimationFrame ||
                            function (e) {
                                return setTimeout(e, 16.67)
                            };
            if (!b.addEventListener) return;
            c.addEventListener(resizeEvt, recalc, false);
            b.addEventListener('DOMContentLoaded', recalc, false)
        })(document, window);
    </script>
    <!-- 页面加载完成特效开始-->
    <script>
        document.onreadystatechange = subSomething;//当页面加载状态改变的时候执行这个方法.
        function subSomething() {
            if (document.readyState == 'complete') //当页面加载状态
            {
                var myLoading = document.getElementById('myLoading');
                myLoading.style.display = 'none';
            }
        }
    </script>
    <!-- 页面加载完成特效结束-->
    <link rel="stylesheet" href="lib/weiui/dist/style/weui.min.css"/>
    <link rel="stylesheet" href="css/common.css"/>
    <link rel="stylesheet" href="css/homePage.css?v=564122"/>
</head>
<body>
<!--延迟加载特效开始-->
<div id="myLoading" class="myLoading">
    <div class="myLoading-change">

    </div>
</div>
<!--延迟加载特效结束-->


<!--主页部分开始-->
<div class="main">
    <!-- 背景光特效-->
    <div class="main-light">
        <!-- 顶部部分开始-->
        <div class="main-top">
            <div class="main-top-scratchCard">
            </div>
            <div class="main-top-message">
                <span>小熊出品刮刮卡</span>
            </div>
        </div>
        <!-- 顶部部分结束-->

        <!-- 底部部分开始-->
        <div class="main-bottom">
            <!-- 刮奖部分-->
            <div class="main-bottom-goodLuck">
                <div class="main-bottom-goodLuck-btn">
                    <div class="prizeContent">恭喜获得<span>丰谷</span></div>
                    <div class="playPrize"></div>
                    <div class="playAgain"></div>
                    <canvas id="myCanvas" width="180%" height="100%"></canvas>
                </div>
            </div>
            <!-- 领奖部分-->
            <div class="main-prize-button">
                <div class="main-prize-myPrize"></div>
                <div class="main-prize-myRule"></div>
                <div class="main-prize-record"></div>
            </div>
        </div>
        <!-- 底部部分结束-->
    </div>
</div>
<!--主页部分结束-->

<!--中奖主页开始-->
<div class="homePage"></div>
<!--中奖主页结束-->

<!--我的奖品开始-->
<div class="myPrize poRe">
    <!-- 奖品标题开始-->
    <h3>我的奖品</h3>
    <!-- 奖品标题结束-->
    <!-- 奖品区开始-->
    <!-- 1-->
    <div class="prize-content">
        <div>
            <div class="prize-content-img f_left">
                <img src="images/prize-content-img.jpg"/>
            </div>
            <div class="prize-content-main f_left">
                <p>5元代金劵</p>

                <p>暂未领取</p>
            </div>
            <div class="prize-content-arrows f_right"></div>
        </div>
        <!-- 获奖信息-->
        <p class="prize-Awards">获奖时间 2016-05-30 13:48:48</p>
    </div>
    <!-- 2-->
    <div class="prize-content">
        <div>
            <div class="prize-content-img f_left">
                <img src="images/prize-content-img.jpg"/>
            </div>
            <div class="prize-content-main f_left">
                <p>5元代金劵</p>

                <p>暂未领取</p>
            </div>
            <div class="prize-content-arrows f_right"></div>
        </div>
        <!-- 获奖信息-->
        <p class="prize-Awards">获奖时间 2016-05-30 13:48:48</p>
    </div>
    <!-- 3-->
    <div class="prize-content">
        <div>
            <div class="prize-content-img f_left">
                <img src="images/prize-content-img.jpg"/>
            </div>
            <div class="prize-content-main f_left">
                <p>5元代金劵</p>

                <p>暂未领取</p>
            </div>
            <div class="prize-content-arrows f_right"></div>
        </div>
        <!-- 获奖信息-->
        <p class="prize-Awards">获奖时间 2016-05-30 13:48:48</p>
    </div>
    <!-- 4-->
    <div class="prize-content">
        <div>
            <div class="prize-content-img f_left">
                <img src="images/prize-content-img.jpg"/>
            </div>
            <div class="prize-content-main f_left">
                <p>5元代金劵</p>

                <p>暂未领取</p>
            </div>
            <div class="prize-content-arrows f_right"></div>
        </div>
        <!-- 获奖信息-->
        <p class="prize-Awards">获奖时间 2016-05-30 13:48:48</p>
    </div>
    <!-- 奖品区结束-->
    <!-- 关闭按钮开始-->
    <div class="prize-close poFi">
        <a href="#" class="weui_btn weui_btn_warn">
            <div>
                <img src="images/X.png"/>
            </div>
        </a>
    </div>
    <!-- 关闭按钮结束-->
</div>
<!--我的奖品结束-->

<!--活动规则开始-->
<div class="myRule">
    <!-- 标题部分-->
    <h3>活动规则</h3>
    <!-- 活动内容-->
    <div class="rule-main">
        <p>
            实现过程： <br/>
            1.一共包含：主页,我的奖品页，活动规则页，中奖纪录页，提交信息页，现场奖品和虚拟奖品页。<br/>
            2.用rem实现等比例布局 <br/>
            3.用cs和js写了一个loading<br/>
            4.用定时器实现的背景图切换,c3只能在iphone6s和手机的Safari浏览器上好使 <br/>
            5.刮刮乐功能使用canvas的globalCompositeOperation属性source-out实现 <br/>
            6.引用了移动端zepto框架,试用了weiui <br/>
            7.主页上下图片固定,不同设备端高度自适应 <br/>
            8.关于我的奖品区,使用了c3的滚动功能.用js性能和实现都很差 <br/>
        </p>
    </div>
    <!-- 关闭按钮开始-->
    <div class="prize-close poFi">
        <a href="#" class="weui_btn weui_btn_warn">
            <img src="images/X.png"/>
        </a>
    </div>
    <!-- 关闭按钮结束-->
</div>
<!--活动规则结束-->

<!--中奖纪录开始-->
<div class="WinningRecord">
    <!-- 标题部分开始-->
    <h3>中奖纪录</h3>
    <!-- 活动内容部分开始-->
    <div class="winnngMain">
        <p>2016-05-30 12:25:57 <span>小熊</span> ***刚刚获得了玩具。</p>

        <p>2016-05-30 12:25:57 <span>小熊</span> ***刚刚获得了玩具。</p>

        <p>2016-05-30 12:25:57 <span>小熊</span> ***刚刚获得了玩具。</p>
    </div>
    <!-- 关闭按钮开始-->
    <div class="prize-close poFi">
        <a href="#" class="weui_btn weui_btn_warn">
            <img src="images/X.png"/>
        </a>
    </div>
    <!-- 关闭按钮结束-->
</div>
<!--中奖纪录结束-->

<!--提交信息页面开始-->
<div class="informationDelivery">
    <!-- 标题部分开始-->
    <h3>恭喜获得 丰谷</h3>
    <!-- 中奖图片部分-->
    <div class="Winning-img">
        <img src="images/prize-content-img.jpg"/>
    </div>
    <!-- 完善信息部分-->
    <div class="perfect-information">
        <h6>请完善如下信息后领奖:</h6>

        <div class="info-content">
            <label for="name">
                姓名：
                <input id="name" type="text" disabled placeholder="请输入姓名"/>
            </label>
            <li></li>
            <label for="phone">
                手机号：
                <input id="phone" type="text" class="info-content-phone" disabled placeholder="请输入手机号"/>
            </label>
            <li></li>
            <label for="adress">
                地址：
                <input id="adress" type="text" disabled placeholder="请输入地址"/>
            </label>
        </div>
    </div>
    <!-- 提交按钮部分-->
    <div class="prize-close poFi">
        <a href="#" class="weui_btn weui_btn_warn">提交</a>
    </div>
</div>
<!--提交信息页面结束-->

<!--现场奖品部分开始-->
<div class="scene-Prize">
    <!-- 标题部分开始-->
    <h3>气球</h3>
    <!-- 奖品图片内容-->
    <div class="prize-img">
        <img src="images/prize-content-img.jpg"/>
    </div>

    <!-- 现场领奖二维码-->
    <div class="scene-2Dbarcode">
        <h3>现场领奖二维码请示出</h3>

        <div class="scene-2Dbarcode-img">
            <img src="images/prize-content-img.jpg"/>
        </div>
    </div>

    <!-- 现场领奖须知-->
    <div class="scene-youKnow">
        <h3>现场领奖须知</h3>

        <div class="scene-youKnow-rule">
            <p>现场领奖须知现场领奖须知现场领奖须知现场领奖须知现场领奖须知</p>

            <p>现场领奖须知现场领奖须知现场领奖须知现场领奖须知现场领奖须知</p>

            <p>现场领奖须知现场领奖须知现场领奖须知现场领奖须知现场领奖须知</p>

            <p>现场领奖须知现场领奖须知现场领奖须知现场领奖须知现场领奖须知</p>
        </div>
    </div>

</div>
<!--现场奖品部分结束-->

<!--虚拟奖品部分开始-->
<div class="virtual-prize">
    <!-- 标题部分开始-->
    <h3>话费</h3>
    <!-- 奖品图片内容-->
    <div class="virtual-prize-img">
        <img src="images/prize-content-img.jpg"/>
    </div>
    <!-- 虚拟代码-->
    <div class="virtual-prize-content">
        <h3>虚拟代码</h3>
        <input type="text" value="7897987"/>
    </div>
    <!-- 虚拟代码使用指南-->
    <div class="virtual-prize-content">
        <h3>虚拟代码使用指南</h3>
        <input type="text" value="请到官网输入此指南充值可使用"/>
    </div>
</div>
<!--虚拟奖品部分结束-->

</body>
</html>
<!--引入zepto及相关插件-->
<script src="lib/zepto/zepto.min.js"></script>
<!--引入selector-->
<script src="lib/zepto/selector.js"></script>
<!--引入fx-->
<script src="lib/zepto/fx.js"></script>
<!--touch-->
<script src="lib/zepto/touch.js"></script>
<!--引入自己的js-->
<script src="js/homePage.js"></script>
<script>
    //原生js实现背景图片轮播问题
    var isPrize = 5;
    var carouselTimer = null;
    var carouselNum = true;
    carouselTimer = setInterval(function () {
        if (carouselNum) {
            $('.main-light').css({
                background: 'url("./images/bgc-light2.png") no-repeat center'
            });
            carouselNum = false;
        } else {
            $('.main-light').css({
                background: 'url("./images/bgc-light1.png") no-repeat center'
            });
            carouselNum = true;
        }
    }, 1000);

    //    页面其他特效区(zepto)
    $(function () {
        //实现点击规则，弹出对应的动画。
        $('.main-prize-myPrize').tap(function () {
            $(".myPrize").animate({
                        opacity: 1,
                        top: '0',
                    }, 100,
                    'ease-out', function () {
                        $('.myPrize > .prize-close').show();
                        $('.myPrize > .prize-close > a').html('<div><img src="images/X.png"/></div>');
                        $('.prize-close').tap(function () {
                            $('.myPrize').animate({
                                opactiy: 1,
                                top: '100%',
                            }, 100, 'ease-out', function () {
                                $('.myPrize > .prize-close').hide();
                            })
                        });
                    });
        });


        $('.main-prize-myRule').tap(function () {
            $(".myRule").animate({
                        opacity: 1,
                        top: '0',
                        height: '100%'
                    }, 100,
                    'ease-out', function () {
                        $('.myRule > .prize-close').show();
                        $('.myRule > .prize-close > a').html('<img src="images/X.png"/>');
                        $('.myRule > .prize-close').tap(function () {
                            $('.myRule').animate({
                                opactiy: 1,
                                top: '100%',
                            }, 100, 'ease-out', function () {
                                $('.myRule > .prize-close').hide();
                            })
                        });
                    });
        });

        $('.main-prize-record').tap(function () {
            $(".WinningRecord").animate({
                        opacity: 1,
                        top: '0',
                        left: '0',
                        height: '100%'
                    }, 100,
                    'ease-out', function () {
                        $('.WinningRecord > .prize-close').show();
                        $('.WinningRecord > .prize-close > a').html('<img src="images/X.png"/>');
                        $('.WinningRecord > .prize-close').tap(function () {
                            $('.WinningRecord').animate({
                                opactiy: 1,
                                top: '100%',
                            }, 100, 'ease-out', function () {
                                $('.WinningRecord > .prize-close').hide();
                            });
                        });
                    });
        });

//        点击按钮跳转到对应页面
    });

    //刮刮乐功能部分(核心功能区)
    var myCanvas = document.getElementById('myCanvas');
    var gooLuckBtn = document.querySelector('.main-bottom-goodLuck-btn');
    var mainBottom = document.querySelector('.main-bottom');
    var gray = myCanvas.getContext('2d');
    //模拟数据库取数据
    var winPrizes = ['没中奖', '中奖'];
    //用于标识第一次触发
    var prizesNum = [];
    var firstPrizeNum = 0;
    //用于判断按钮是否移动的事件
    var btnMove = {};
    //挂挂特效
    gray.beginPath();//开始一个路径
    gray.fillStyle = "#999";
    gray.fillRect(0, 0, 320, 400);//绘制一个路径
    gray.closePath();//闭合路径
    gray.globalCompositeOperation = "destination-out";//关键属性
    myCanvas.addEventListener('touchstart', function (e) {
        e.preventDefault();
        firstPrizeNum++;
        prizesNum[firstPrizeNum] = parseInt((Math.random() * 3)) % (winPrizes.length);
    });
    myCanvas.addEventListener('touchmove', function (e) {
        e.preventDefault();
        gray.beginPath();
        gray.fillStyle = "#f00";
        gray.arc(e.targetTouches[0].clientX - gooLuckBtn.offsetLeft - 20,
                e.targetTouches[0].clientY - mainBottom.offsetTop - gooLuckBtn.offsetTop + 60,
                20, 0, Math.PI * 2);
        gray.fill();
        gray.closePath();

        //显示(是否中奖)背景图片样式
        isPrize = winPrizes[prizesNum[1]];
//        isPrize = '中奖';
        if (isPrize == '中奖') {
            $('.prizeContent').html('恭喜获得<span>丰谷</span>');
            $('.playPrize').show();
            $('.playAgain').hide();
        } else {
            $('.prizeContent').html('很遗憾,没有中奖');
            $('.playPrize').hide();
            $('.playAgain').show();
        }

    });
    myCanvas.addEventListener('touchend', function (e) {
        e.preventDefault();
        var num = 0;
        var datas = gray.getImageData(0, 0, 320, 400);
        for (var i = 0; i < datas.data.length; i++) {
            if (datas.data[i] == 0) {
                num++;
            }
        }
        if (num >= datas.data.length * 0.9) {
            gray.fillRect(0, 0, 320, 400);
            //需要先影藏canvas
            $('#myCanvas').hide();
            if (isPrize == '中奖') {
                //中奖之后的一系列逻辑操作
                $('.playPrize').tap(function () {
                    $('.informationDelivery').animate({
                        opacity: 1,
                        top: '0',
                        left: '0',
                        height: '100%'
                    }, 50, 'ease-out', function () {
                        //用于解决获取自动获取焦点问题
                        setTimeout(function () {
                            $('#name,#phone,#adress').removeAttr('disabled');
                        }, 500);
                        $('.informationDelivery > .prize-close').show();
                        $('.informationDelivery > .prize-close > a').html('提交');
                        $('.informationDelivery > .prize-close').tap(function () {
                            if ($('.informationDelivery > .prize-close > a').html() == 'OK') {
                                window.location.reload();
                            } else {
                                $('.informationDelivery > h3').html('丰谷');
                                $('.perfect-information > h6').html('你已成功提交信息，提交内容如下');
                                $('.informationDelivery > .prize-close > a').html('OK');
                            }
                        });
                    })
                });
            } else {
                //没中奖之后的一系列逻辑操作
                $('.playAgain').tap(function () {
                    window.location.reload();
                });
            }
        }
    });


    //对button功能进行特殊处理，不让浏览器行为影响提交和关闭按钮
    //    document.addEventListener('touchstart', function (e) {
    //        var isZero = parseInt($('.myPrize').css('top'));
    //        btnMove.move = false;
    //        if (isZero == 0) {
    //            btnMove.move = true;
    //            var ev = e || window.ev;
    //            btnMove.topF = ev.touches[0].clientY;
    //        }
    //    });
    //    document.addEventListener('touchmove', function (e) {
    //        var ev = e || window.ev;
    //        btnMove.topL = ev.touches[0].clientY;
    //        btnMove.change = btnMove.topF - btnMove.topL;
    //        console.log(btnMove.change)
    //        //如果差值大于0，做处理
    //        if (btnMove.change > 0) {
    //            $('.myPrize > .prize-close').css({
    //                bottom: btnMove.change / 100 + 'rem'
    //            });
    //        }
    //
    //        console.log($('.myPrize > .prize-close').css('bottom'));
    //    });
    //    document.addEventListener('touchend', function (e) {
    //        $('.myPrize > .prize-close').css({
    //            bottom: 0
    //        });
    //    });

</script>